{"version":3,"file":"ConnectionHealthData.js","sourceRoot":"","sources":["../../src/connectionhealthpolicy/ConnectionHealthData.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nexport default class ConnectionHealthData {\n  connectionStartTimestampMs = 0;\n  consecutiveStatsWithNoPackets = 0;\n  consecutiveStatsWithNoAudioPacketsSent = 0;\n  lastPacketLossInboundTimestampMs = 0;\n  lastGoodSignalTimestampMs = 0;\n  lastWeakSignalTimestampMs = 0;\n  lastNoSignalTimestampMs = 0;\n  consecutiveMissedPongs = 0;\n  packetsReceivedInLastMinute: number[] = [];\n  fractionPacketsLostInboundInLastMinute: number[] = [];\n  audioSpeakerDelayMs = 0;\n  isVideoEncoderHardware = false;\n  videoEncodingTimeInMs = 0;\n  videoEncodingTimePerFrameInMs = 0;\n  cpuLimitationDuration = 0;\n  videoInputFps = 0;\n  videoEncodeFps = 0;\n\n  constructor() {\n    this.connectionStartTimestampMs = Date.now();\n    this.lastGoodSignalTimestampMs = Date.now();\n  }\n  private static isTimestampRecent(timestampMs: number, recentDurationMs: number): boolean {\n    return Date.now() < timestampMs + recentDurationMs;\n  }\n\n  setConnectionStartTime(): void {\n    this.connectionStartTimestampMs = Date.now();\n    this.lastGoodSignalTimestampMs = Date.now();\n  }\n\n  reset(): void {\n    this.connectionStartTimestampMs = 0;\n    this.consecutiveStatsWithNoPackets = 0;\n    this.consecutiveStatsWithNoAudioPacketsSent = 0;\n    this.lastPacketLossInboundTimestampMs = 0;\n    this.lastGoodSignalTimestampMs = 0;\n    this.lastWeakSignalTimestampMs = 0;\n    this.lastNoSignalTimestampMs = 0;\n    this.consecutiveMissedPongs = 0;\n    this.packetsReceivedInLastMinute = [];\n    this.fractionPacketsLostInboundInLastMinute = [];\n    this.audioSpeakerDelayMs = 0;\n    this.connectionStartTimestampMs = Date.now();\n    this.lastGoodSignalTimestampMs = Date.now();\n    this.isVideoEncoderHardware = false;\n    this.videoEncodingTimeInMs = 0;\n    this.videoEncodingTimePerFrameInMs = 0;\n    this.cpuLimitationDuration = 0;\n    this.videoInputFps = 0;\n    this.videoEncodeFps = 0;\n  }\n\n  isConnectionStartRecent(recentDurationMs: number): boolean {\n    return ConnectionHealthData.isTimestampRecent(\n      this.connectionStartTimestampMs,\n      recentDurationMs\n    );\n  }\n  isLastPacketLossRecent(recentDurationMs: number): boolean {\n    return ConnectionHealthData.isTimestampRecent(\n      this.lastPacketLossInboundTimestampMs,\n      recentDurationMs\n    );\n  }\n  isGoodSignalRecent(recentDurationMs: number): boolean {\n    return ConnectionHealthData.isTimestampRecent(this.lastGoodSignalTimestampMs, recentDurationMs);\n  }\n  isWeakSignalRecent(recentDurationMs: number): boolean {\n    return ConnectionHealthData.isTimestampRecent(this.lastWeakSignalTimestampMs, recentDurationMs);\n  }\n  isNoSignalRecent(recentDurationMs: number): boolean {\n    return ConnectionHealthData.isTimestampRecent(this.lastNoSignalTimestampMs, recentDurationMs);\n  }\n  clone(): ConnectionHealthData {\n    const cloned = new ConnectionHealthData();\n    cloned.connectionStartTimestampMs = this.connectionStartTimestampMs;\n    cloned.consecutiveStatsWithNoPackets = this.consecutiveStatsWithNoPackets;\n    cloned.consecutiveStatsWithNoAudioPacketsSent = this.consecutiveStatsWithNoAudioPacketsSent;\n    cloned.lastPacketLossInboundTimestampMs = this.lastPacketLossInboundTimestampMs;\n    cloned.lastGoodSignalTimestampMs = this.lastGoodSignalTimestampMs;\n    cloned.lastWeakSignalTimestampMs = this.lastWeakSignalTimestampMs;\n    cloned.lastNoSignalTimestampMs = this.lastNoSignalTimestampMs;\n    cloned.consecutiveMissedPongs = this.consecutiveMissedPongs;\n    cloned.packetsReceivedInLastMinute = this.packetsReceivedInLastMinute.slice(0);\n    cloned.fractionPacketsLostInboundInLastMinute = this.fractionPacketsLostInboundInLastMinute.slice(\n      0\n    );\n    cloned.audioSpeakerDelayMs = this.audioSpeakerDelayMs;\n    cloned.isVideoEncoderHardware = this.isVideoEncoderHardware;\n    cloned.videoEncodingTimeInMs = this.videoEncodingTimeInMs;\n    cloned.videoEncodingTimePerFrameInMs = this.videoEncodingTimePerFrameInMs;\n    cloned.cpuLimitationDuration = this.cpuLimitationDuration;\n    cloned.videoInputFps = this.videoInputFps;\n    cloned.videoEncodeFps = this.videoEncodeFps;\n    return cloned;\n  }\n  setConsecutiveMissedPongs(pongs: number): void {\n    this.consecutiveMissedPongs = pongs;\n  }\n  setConsecutiveStatsWithNoPackets(stats: number): void {\n    this.consecutiveStatsWithNoPackets = stats;\n  }\n  setConsecutiveStatsWithNoAudioPacketsSent(stats: number): void {\n    this.consecutiveStatsWithNoAudioPacketsSent = stats;\n  }\n  setLastPacketLossInboundTimestampMs(timeStamp: number): void {\n    this.lastPacketLossInboundTimestampMs = timeStamp;\n  }\n  setLastNoSignalTimestampMs(timeStamp: number): void {\n    this.lastNoSignalTimestampMs = timeStamp;\n  }\n  setLastWeakSignalTimestampMs(timeStamp: number): void {\n    this.lastWeakSignalTimestampMs = timeStamp;\n  }\n  setLastGoodSignalTimestampMs(timeStamp: number): void {\n    this.lastGoodSignalTimestampMs = timeStamp;\n  }\n  setAudioSpeakerDelayMs(delayMs: number): void {\n    this.audioSpeakerDelayMs = delayMs;\n  }\n  setIsVideoEncoderHardware(isHardware: boolean): void {\n    this.isVideoEncoderHardware = isHardware;\n  }\n  setVideoEncodingTimeInMs(stats: number): void {\n    this.videoEncodingTimeInMs = stats;\n  }\n  setVideoEncodingTimePerFrameInMs(stats: number): void {\n    this.videoEncodingTimePerFrameInMs = stats;\n  }\n  setCpuLimitationDuration(stats: number): void {\n    this.cpuLimitationDuration = stats;\n  }\n  setVideoInputFps(stats: number): void {\n    this.videoInputFps = stats;\n  }\n  setVideoEncodeFps(stats: number): void {\n    this.videoEncodeFps = stats;\n  }\n}\n"]}