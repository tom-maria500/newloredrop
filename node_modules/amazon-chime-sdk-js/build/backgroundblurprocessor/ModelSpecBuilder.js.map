{"version":3,"file":"ModelSpecBuilder.js","sourceRoot":"","sources":["../../src/backgroundblurprocessor/ModelSpecBuilder.ts"],"names":[],"mappings":";AAAA,qEAAqE;AACrE,sCAAsC;;AAKtC;;GAEG;AACH,MAAqB,gBAAgB;IAArC;QACU,SAAI,GAAW,IAAI,CAAC;QACpB,UAAK,GAAe,IAAI,CAAC;QACzB,WAAM,GAAe,IAAI,CAAC;IAyGpC,CAAC;IAxGC,MAAM,CAAC,OAAO;QACZ,OAAO,IAAI,gBAAgB,EAAE,CAAC;IAChC,CAAC;IAED;;;;;;;OAOG;IACH,gBAAgB;QACd,OAAO,IAAI,CAAC,8BAA8B,EAAE,CAAC;IAC/C,CAAC;IAED;;;OAGG;IACH,8BAA8B;QAC5B,MAAM,wBAAwB,GAAe;YAC3C,MAAM,EAAE,GAAG;YACX,KAAK,EAAE,GAAG;YACV,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;YACb,QAAQ,EAAE,CAAC;SACZ,CAAC;QAEF,MAAM,yBAAyB,GAAe;YAC5C,MAAM,EAAE,GAAG;YACX,KAAK,EAAE,GAAG;YACV,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;YACb,QAAQ,EAAE,CAAC;SACZ,CAAC;QAEF,MAAM,yBAAyB,GAC7B,uFAAuF,CAAC;QAE1F,IAAI,CAAC,IAAI,GAAG,yBAAyB,CAAC;QACtC,IAAI,CAAC,KAAK,GAAG,wBAAwB,CAAC;QACtC,IAAI,CAAC,MAAM,GAAG,yBAAyB,CAAC;QACxC,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;OAIG;IACH,QAAQ,CAAC,IAAY;QACnB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;OAIG;IACH,SAAS,CAAC,KAAiB;QACzB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;OAIG;IACH,UAAU,CAAC,MAAkB;QAC3B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;OAEG;IACK,QAAQ;QACd,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;YACd,MAAM,IAAI,KAAK,CAAC,4BAA4B,CAAC,CAAC;SAC/C;QAED,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;YACf,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAC;SAChD;QAED,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YAChB,MAAM,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC;SACjD;IACH,CAAC;IAED;;;;OAIG;IACH,KAAK;QACH,IAAI,CAAC,QAAQ,EAAE,CAAC;QAChB,OAAO;YACL,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,MAAM,EAAE,IAAI,CAAC,MAAM;SACpB,CAAC;IACJ,CAAC;CACF;AA5GD,mCA4GC","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport ModelShape from '../modelspec/ModelShape';\nimport ModelSpec from '../modelspec/ModelSpec';\n\n/**\n * A builder class to instantiate a model spec.\n */\nexport default class ModelSpecBuilder {\n  private path: string = null;\n  private input: ModelShape = null;\n  private output: ModelShape = null;\n  static builder(): ModelSpecBuilder {\n    return new ModelSpecBuilder();\n  }\n\n  /**\n   * Set up the builder to use the default model implementation.\n   *\n   * Members of this interface can change without a major version bump to accommodate new browser\n   * bugs and capabilities. If you extend this type, you might need to rework your code for new minor\n   * versions of this library.\n   * @returns a reference to the current builder.\n   */\n  withDefaultModel(): ModelSpecBuilder {\n    return this.withSelfieSegmentationDefaults();\n  }\n\n  /**\n   * Set up the builder to use the defaults for selfie segmentation model.\n   * @returns the builder to allow for fluent API (e.g., ModelSpecBuilder.withSelfieSegmentationDefaults().build()).\n   */\n  withSelfieSegmentationDefaults(): ModelSpecBuilder {\n    const SELFIE_MODEL_INPUT_SHAPE: ModelShape = {\n      height: 144,\n      width: 256,\n      range: [0, 1],\n      channels: 3,\n    };\n\n    const SELFIE_MODEL_OUTPUT_SHAPE: ModelShape = {\n      height: 144,\n      width: 256,\n      range: [0, 1],\n      channels: 1,\n    };\n\n    const DEFAULT_SELFIE_MODEL_PATH =\n      'https://static.sdkassets.chime.aws/bgblur/models/selfie_segmentation_landscape.tflite';\n\n    this.path = DEFAULT_SELFIE_MODEL_PATH;\n    this.input = SELFIE_MODEL_INPUT_SHAPE;\n    this.output = SELFIE_MODEL_OUTPUT_SHAPE;\n    return this;\n  }\n\n  /**\n   * A method to override the path to the segmentation model.\n   * @param path A function that returns the path to the segmentation model.\n   * @returns the builder to allow for fluent API (e.g., ModelSpecBuilder.builder().withPath(\"some path\").build()).\n   */\n  withPath(path: string): ModelSpecBuilder {\n    this.path = path;\n    return this;\n  }\n\n  /**\n   * A method to override the input shape to the segmentation model.\n   * @param input An object that defines input shape of the segmentation model.\n   * @returns the builder to allow for fluent API (e.g., ModelSpecBuilder.builder().withInput({}).build()).\n   */\n  withInput(input: ModelShape): ModelSpecBuilder {\n    this.input = input;\n    return this;\n  }\n\n  /**\n   * A method to override the output shape to the segmentation model.\n   * @param input An object that defines input shape of the segmentation model.\n   * @returns the builder to allow for fluent API (e.g., ModelSpecBuilder.builder().withOutput({}).build()).\n   */\n  withOutput(output: ModelShape): ModelSpecBuilder {\n    this.output = output;\n    return this;\n  }\n\n  /**\n   * Validate that inputs to the model spec are valid.\n   */\n  private validate(): void {\n    if (!this.path) {\n      throw new Error('model spec path is not set');\n    }\n\n    if (!this.input) {\n      throw new Error('model spec input is not set');\n    }\n\n    if (!this.output) {\n      throw new Error('model spec output is not set');\n    }\n  }\n\n  /**\n   * A method that returns an instantiated object that implements the ModelSpec interface with values set for\n   * the use of the selfie segmentation model.\n   * @returns an object that implements the ModelSpec interface.\n   */\n  build(): ModelSpec {\n    this.validate();\n    return {\n      path: this.path,\n      input: this.input,\n      output: this.output,\n    };\n  }\n}\n"]}